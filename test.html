<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Scanner</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
  <style>
    #qr-reader {
      width: 100%;
      max-width: 400px;
      margin: 20px auto;
    }
    .content {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<!-- Page Content -->
<div class="container text-center mt-5">
  <!-- QR Code Reader -->




  <!-- Reload Button -->
  <button class="btn btn-secondary mt-3" onclick="resetScanner()">Reset Scanner</button>
</div>
<script src="js/jquery-3.7.1.min.js"></script>
<script>
  // Initialize QR Code Reader
  const qrReader = new Html5Qrcode("qr-reader");

  function startScanner() {
    // Request a list of cameras to select the primary (main) rear camera
    Html5Qrcode.getCameras().then(devices => {
      // Select the first rear camera (usually the main camera)
      const mainCamera = devices.find(device => device.label.toLowerCase().includes("back") || device.label.toLowerCase().includes("rear"));
      const cameraId = mainCamera ? mainCamera.id : { facingMode: "environment" };

      qrReader.start(
              cameraId,
              { fps: 10, qrbox: 250 },
              (decodedText) => {

                $.ajax({
                  //https://q.afreespace.com/m3sUkpAz
                  url:decodedText.replace("http://", "https://"),
                  success:function (res){
                   let decodedID= $(res).find('#temp-table').children('tbody').children('tr:nth-child(1)').children('td:nth-child(2)').text();
                    $('#scanned-text').text(decodedID);
                  }
                });
                qrReader.stop();
              },
              (errorMessage) => {
                console.warn(`QR Code scan error: ${errorMessage}`);
              }
      );
    }).catch(err => {
      console.error("Error accessing cameras:", err);
    });
  }

  // Start scanning on page load
  window.addEventListener('load', startScanner);

  // Reset the scanner
  function resetScanner() {
    document.getElementById("scanned-text").textContent = "No content yet";
    startScanner();
  }
</script>

</body>
</html>
